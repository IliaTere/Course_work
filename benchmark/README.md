# Бенчмарк PostgreSQL для Python

Этот проект представляет собой набор инструментов для тестирования производительности работы с базой данных PostgreSQL в Python с использованием как SQLAlchemy ORM, так и чистого SQL через psycopg2.

## Описание тестов

Проект включает в себя следующие тесты:

### Основные тесты (benchmark.py, benchmark_raw.py)
1. **Получение одного пользователя по ID**: запрос одной записи пользователя с ID 123
2. **Получение таблицы с 10 пользователями**: запрос ограниченного набора пользователей (LIMIT 10)
3. **Получение таблицы с 10000 пользователями**: запрос всех пользователей из базы данных

### Сравнение размеров таблиц (benchmark_size.py)
Специальное сравнение времени получения пользователя с ID 123 из таблиц различных размеров:
1. Запрос пользователя из таблицы с 10 строками
2. Запрос пользователя из таблицы с 10000 строками

Каждый тест проводится как с использованием SQLAlchemy ORM, так и с чистым SQL через psycopg2.

## Результаты бенчмарка

### Основные тесты

Результаты показывают среднее время выполнения каждого запроса в миллисекундах:

#### SQLAlchemy ORM

- Получение пользователя с ID 123: **2.57 ms**
- Получение таблицы с 10 пользователями: **0.81 ms**
- Получение таблицы с 10000 пользователями: **58.16 ms**

#### Чистый SQL (psycopg2)

- Получение пользователя с ID 123: **0.46 ms**
- Получение таблицы с 10 пользователями: **0.16 ms**
- Получение таблицы с 10000 пользователями: **9.48 ms**

#### Сравнение производительности

- Получение пользователя с ID 123: ORM в **5.59x** раз медленнее чистого SQL
- Получение таблицы с 10 пользователями: ORM в **4.95x** раз медленнее чистого SQL
- Получение таблицы с 10000 пользователями: ORM в **6.14x** раз медленнее чистого SQL

### Сравнение производительности запросов в таблицах разного размера

Результаты показывают среднее время выполнения запроса пользователя с ID 123 из таблиц разного размера:

#### Среднее время запросов

- ORM, таблица с 10 строками: **0.50 ms** (стд. откл. 0.02 ms)
- ORM, таблица с 10000 строками: **0.44 ms** (стд. откл. 0.03 ms)
- SQL, таблица с 10 строками: **0.13 ms** (стд. откл. 0.01 ms)
- SQL, таблица с 10000 строками: **0.15 ms** (стд. откл. 0.02 ms)

#### Сравнение размеров таблиц

- ORM: Запрос в таблице с 10000 строк **быстрее в 0.88x раз**
- SQL: Запрос в таблице с 10000 строк **медленнее в 1.09x раз**

#### Сравнение ORM vs SQL

- Таблица с 10 строками: ORM в **3.73x раз медленнее** SQL
- Таблица с 10000 строками: ORM в **3.03x раз медленнее** SQL

### Выводы

1. При выполнении запросов по первичному ключу (ID) размер таблицы практически не влияет на скорость запроса, благодаря индексированию.
2. ORM (SQLAlchemy) примерно в 3-6 раз медленнее чистого SQL для базовых операций.
3. Разница в производительности становится более выраженной при получении больших наборов данных.

## Требования

- Python 3.6+
- PostgreSQL 10+
- psycopg2-binary
- SQLAlchemy

## Установка и запуск

1. Создайте виртуальное окружение Python:
   ```
   python3 -m venv venv
   source venv/bin/activate
   ```

2. Установите зависимости:
   ```
   pip install psycopg2-binary sqlalchemy
   ```

3. Создайте пользователя и базу данных PostgreSQL:
   ```
   sudo -u postgres psql -c "CREATE USER benchmark WITH PASSWORD 'benchmark' CREATEDB;"
   sudo -u postgres psql -c "CREATE DATABASE benchmark OWNER benchmark;"
   ```

4. Запустите бенчмарк:
   ```
   ./run_benchmarks.py
   ```

## Файлы проекта

- `benchmark.py` - бенчмарк с использованием SQLAlchemy ORM
- `benchmark_raw.py` - бенчмарк с использованием чистого SQL через psycopg2
- `run_benchmarks.py` - скрипт для запуска обоих бенчмарков и сбора статистики 